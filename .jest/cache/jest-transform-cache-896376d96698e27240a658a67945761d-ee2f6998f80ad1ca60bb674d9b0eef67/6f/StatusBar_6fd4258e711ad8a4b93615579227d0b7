74f0b1a0d34908cbb36f33f07d6d9005
'use strict';

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _classCallCheck2 = _interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _possibleConstructorReturn2 = _interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));

var _getPrototypeOf3 = _interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));

var _inherits2 = _interopRequireDefault(require("@babel/runtime/helpers/inherits"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _StatusBarManager$DEF;

var React = require('react');

var Platform = require('../../Utilities/Platform');

var processColor = require('../../StyleSheet/processColor');

var StatusBarManager = require('../../BatchedBridge/NativeModules').StatusBarManager;

function mergePropsStack(propsStack, defaultValues) {
  return propsStack.reduce(function (prev, cur) {
    for (var prop in cur) {
      if (cur[prop] != null) {
        prev[prop] = cur[prop];
      }
    }

    return prev;
  }, (0, _extends2.default)({}, defaultValues));
}

function createStackEntry(props) {
  return {
    backgroundColor: props.backgroundColor != null ? {
      value: props.backgroundColor,
      animated: props.animated
    } : null,
    barStyle: props.barStyle != null ? {
      value: props.barStyle,
      animated: props.animated
    } : null,
    translucent: props.translucent,
    hidden: props.hidden != null ? {
      value: props.hidden,
      animated: props.animated,
      transition: props.showHideTransition
    } : null,
    networkActivityIndicatorVisible: props.networkActivityIndicatorVisible
  };
}

var StatusBar = function (_React$Component) {
  (0, _inherits2.default)(StatusBar, _React$Component);

  function StatusBar() {
    var _getPrototypeOf2;

    var _this;

    (0, _classCallCheck2.default)(this, StatusBar);

    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {
      args[_key] = arguments[_key];
    }

    _this = (0, _possibleConstructorReturn2.default)(this, (_getPrototypeOf2 = (0, _getPrototypeOf3.default)(StatusBar)).call.apply(_getPrototypeOf2, [this].concat(args)));
    _this._stackEntry = null;
    return _this;
  }

  (0, _createClass2.default)(StatusBar, [{
    key: "componentDidMount",
    value: function componentDidMount() {
      this._stackEntry = StatusBar.pushStackEntry(this.props);
    }
  }, {
    key: "componentWillUnmount",
    value: function componentWillUnmount() {
      StatusBar.popStackEntry(this._stackEntry);
    }
  }, {
    key: "componentDidUpdate",
    value: function componentDidUpdate() {
      this._stackEntry = StatusBar.replaceStackEntry(this._stackEntry, this.props);
    }
  }, {
    key: "render",
    value: function render() {
      return null;
    }
  }], [{
    key: "setHidden",
    value: function setHidden(hidden, animation) {
      animation = animation || 'none';
      StatusBar._defaultProps.hidden.value = hidden;

      if (Platform.OS === 'ios') {
        StatusBarManager.setHidden(hidden, animation);
      } else if (Platform.OS === 'android') {
        StatusBarManager.setHidden(hidden);
      }
    }
  }, {
    key: "setBarStyle",
    value: function setBarStyle(style, animated) {
      animated = animated || false;
      StatusBar._defaultProps.barStyle.value = style;

      if (Platform.OS === 'ios') {
        StatusBarManager.setStyle(style, animated);
      } else if (Platform.OS === 'android') {
        StatusBarManager.setStyle(style);
      }
    }
  }, {
    key: "setNetworkActivityIndicatorVisible",
    value: function setNetworkActivityIndicatorVisible(visible) {
      if (Platform.OS !== 'ios') {
        console.warn('`setNetworkActivityIndicatorVisible` is only available on iOS');
        return;
      }

      StatusBar._defaultProps.networkActivityIndicatorVisible = visible;
      StatusBarManager.setNetworkActivityIndicatorVisible(visible);
    }
  }, {
    key: "setBackgroundColor",
    value: function setBackgroundColor(color, animated) {
      if (Platform.OS !== 'android') {
        console.warn('`setBackgroundColor` is only available on Android');
        return;
      }

      animated = animated || false;
      StatusBar._defaultProps.backgroundColor.value = color;
      StatusBarManager.setColor(processColor(color), animated);
    }
  }, {
    key: "setTranslucent",
    value: function setTranslucent(translucent) {
      if (Platform.OS !== 'android') {
        console.warn('`setTranslucent` is only available on Android');
        return;
      }

      StatusBar._defaultProps.translucent = translucent;
      StatusBarManager.setTranslucent(translucent);
    }
  }, {
    key: "pushStackEntry",
    value: function pushStackEntry(props) {
      var entry = createStackEntry(props);

      StatusBar._propsStack.push(entry);

      StatusBar._updatePropsStack();

      return entry;
    }
  }, {
    key: "popStackEntry",
    value: function popStackEntry(entry) {
      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack.splice(index, 1);
      }

      StatusBar._updatePropsStack();
    }
  }, {
    key: "replaceStackEntry",
    value: function replaceStackEntry(entry, props) {
      var newEntry = createStackEntry(props);

      var index = StatusBar._propsStack.indexOf(entry);

      if (index !== -1) {
        StatusBar._propsStack[index] = newEntry;
      }

      StatusBar._updatePropsStack();

      return newEntry;
    }
  }]);
  return StatusBar;
}(React.Component);

StatusBar._propsStack = [];
StatusBar._defaultProps = createStackEntry({
  animated: false,
  showHideTransition: 'fade',
  backgroundColor: Platform.select({
    android: (_StatusBarManager$DEF = StatusBarManager.DEFAULT_BACKGROUND_COLOR) != null ? _StatusBarManager$DEF : 'black',
    ios: 'black'
  }),
  barStyle: 'default',
  translucent: false,
  hidden: false,
  networkActivityIndicatorVisible: false
});
StatusBar._updateImmediate = null;
StatusBar._currentValues = null;
StatusBar.currentHeight = StatusBarManager.HEIGHT;
StatusBar.defaultProps = {
  animated: false,
  showHideTransition: 'fade'
};

StatusBar._updatePropsStack = function () {
  clearImmediate(StatusBar._updateImmediate);
  StatusBar._updateImmediate = setImmediate(function () {
    var oldProps = StatusBar._currentValues;
    var mergedProps = mergePropsStack(StatusBar._propsStack, StatusBar._defaultProps);

    if (Platform.OS === 'ios') {
      if (!oldProps || oldProps.barStyle.value !== mergedProps.barStyle.value) {
        StatusBarManager.setStyle(mergedProps.barStyle.value, mergedProps.barStyle.animated || false);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        StatusBarManager.setHidden(mergedProps.hidden.value, mergedProps.hidden.animated ? mergedProps.hidden.transition : 'none');
      }

      if (!oldProps || oldProps.networkActivityIndicatorVisible !== mergedProps.networkActivityIndicatorVisible) {
        StatusBarManager.setNetworkActivityIndicatorVisible(mergedProps.networkActivityIndicatorVisible);
      }
    } else if (Platform.OS === 'android') {
      if (!oldProps || oldProps.barStyle.value !== mergedProps.barStyle.value) {
        StatusBarManager.setStyle(mergedProps.barStyle.value);
      }

      if (!oldProps || oldProps.backgroundColor.value !== mergedProps.backgroundColor.value) {
        StatusBarManager.setColor(processColor(mergedProps.backgroundColor.value), mergedProps.backgroundColor.animated);
      }

      if (!oldProps || oldProps.hidden.value !== mergedProps.hidden.value) {
        StatusBarManager.setHidden(mergedProps.hidden.value);
      }

      if (!oldProps || oldProps.translucent !== mergedProps.translucent) {
        StatusBarManager.setTranslucent(mergedProps.translucent);
      }
    }

    StatusBar._currentValues = mergedProps;
  });
};

module.exports = StatusBar;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlN0YXR1c0Jhci5qcyJdLCJuYW1lcyI6WyJSZWFjdCIsInJlcXVpcmUiLCJQbGF0Zm9ybSIsInByb2Nlc3NDb2xvciIsIlN0YXR1c0Jhck1hbmFnZXIiLCJtZXJnZVByb3BzU3RhY2siLCJwcm9wc1N0YWNrIiwiZGVmYXVsdFZhbHVlcyIsInJlZHVjZSIsInByZXYiLCJjdXIiLCJwcm9wIiwiY3JlYXRlU3RhY2tFbnRyeSIsInByb3BzIiwiYmFja2dyb3VuZENvbG9yIiwidmFsdWUiLCJhbmltYXRlZCIsImJhclN0eWxlIiwidHJhbnNsdWNlbnQiLCJoaWRkZW4iLCJ0cmFuc2l0aW9uIiwic2hvd0hpZGVUcmFuc2l0aW9uIiwibmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSIsIlN0YXR1c0JhciIsIl9zdGFja0VudHJ5IiwicHVzaFN0YWNrRW50cnkiLCJwb3BTdGFja0VudHJ5IiwicmVwbGFjZVN0YWNrRW50cnkiLCJhbmltYXRpb24iLCJfZGVmYXVsdFByb3BzIiwiT1MiLCJzZXRIaWRkZW4iLCJzdHlsZSIsInNldFN0eWxlIiwidmlzaWJsZSIsImNvbnNvbGUiLCJ3YXJuIiwic2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSIsImNvbG9yIiwic2V0Q29sb3IiLCJzZXRUcmFuc2x1Y2VudCIsImVudHJ5IiwiX3Byb3BzU3RhY2siLCJwdXNoIiwiX3VwZGF0ZVByb3BzU3RhY2siLCJpbmRleCIsImluZGV4T2YiLCJzcGxpY2UiLCJuZXdFbnRyeSIsIkNvbXBvbmVudCIsInNlbGVjdCIsImFuZHJvaWQiLCJERUZBVUxUX0JBQ0tHUk9VTkRfQ09MT1IiLCJpb3MiLCJfdXBkYXRlSW1tZWRpYXRlIiwiX2N1cnJlbnRWYWx1ZXMiLCJjdXJyZW50SGVpZ2h0IiwiSEVJR0hUIiwiZGVmYXVsdFByb3BzIiwiY2xlYXJJbW1lZGlhdGUiLCJzZXRJbW1lZGlhdGUiLCJvbGRQcm9wcyIsIm1lcmdlZFByb3BzIiwibW9kdWxlIiwiZXhwb3J0cyJd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S0FGbkQsRUFHRTtBQUNBWCxRQUFBQSxnQkFBZ0IsQ0FBQzZCLFFBQWpCLENBQTBCNkIsV0FBVyxDQUFDN0MsUUFBWixDQUFxQkYsS0FBL0M7QUFDRDs7QUFDRCxVQUNFLENBQUM4QyxRQUFELElBQ0FBLFFBQVEsQ0FBQy9DLGVBQVQsQ0FBeUJDLEtBQXpCLEtBQW1DK0MsV0FBVyxDQUFDaEQsZUFBWixDQUE0QkMsS0FGakUsRUFHRTtBQUNBWCxRQUFBQSxnQkFBZ0IsQ0FBQ21DLFFBQWpCLENBQ0VwQyxZQUFZLENBQUMyRCxXQUFXLENBQUNoRCxlQUFaLENBQTRCQyxLQUE3QixDQURkLEVBRUUrQyxXQUFXLENBQUNoRCxlQUFaLENBQTRCRSxRQUY5QjtBQUlEOztBQUNELFVBQUksQ0FBQzZDLFFBQUQsSUFBYUEsUUFBUSxDQUFDMUMsTUFBVCxDQUFnQkosS0FBaEIsS0FBMEIrQyxXQUFXLENBQUMzQyxNQUFaLENBQW1CSixLQUE5RCxFQUFxRTtBQUNuRVgsUUFBQUEsZ0JBQWdCLENBQUMyQixTQUFqQixDQUEyQitCLFdBQVcsQ0FBQzNDLE1BQVosQ0FBbUJKLEtBQTlDO0FBQ0Q7O0FBQ0QsVUFBSSxDQUFDOEMsUUFBRCxJQUFhQSxRQUFRLENBQUMzQyxXQUFULEtBQXlCNEMsV0FBVyxDQUFDNUMsV0FBdEQsRUFBbUU7QUFDakVkLFFBQUFBLGdCQUFnQixDQUFDb0MsY0FBakIsQ0FBZ0NzQixXQUFXLENBQUM1QyxXQUE1QztBQUNEO0FBQ0Y7O0FBRURLLElBQUFBLFNBQVMsQ0FBQ2dDLGNBQVYsR0FBMkJPLFdBQTNCO0FBQ0QsR0E3RHdDLENBQXpDO0FBOERELEM7O0FBT0hDLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQnpDLFNBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIEZhY2Vib29rLCBJbmMuIGFuZCBpdHMgYWZmaWxpYXRlcy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZm9ybWF0XG4gKiBAZmxvd1xuICovXG5cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgUmVhY3QgPSByZXF1aXJlKCdyZWFjdCcpO1xuY29uc3QgUGxhdGZvcm0gPSByZXF1aXJlKCcuLi8uLi9VdGlsaXRpZXMvUGxhdGZvcm0nKTtcblxuY29uc3QgcHJvY2Vzc0NvbG9yID0gcmVxdWlyZSgnLi4vLi4vU3R5bGVTaGVldC9wcm9jZXNzQ29sb3InKTtcblxuY29uc3QgU3RhdHVzQmFyTWFuYWdlciA9IHJlcXVpcmUoJy4uLy4uL0JhdGNoZWRCcmlkZ2UvTmF0aXZlTW9kdWxlcycpXG4gIC5TdGF0dXNCYXJNYW5hZ2VyO1xuXG4vKipcbiAqIFN0YXR1cyBiYXIgc3R5bGVcbiAqL1xuZXhwb3J0IHR5cGUgU3RhdHVzQmFyU3R5bGUgPSAkS2V5czx7XG4gIC8qKlxuICAgKiBEZWZhdWx0IHN0YXR1cyBiYXIgc3R5bGUgKGRhcmsgZm9yIGlPUywgbGlnaHQgZm9yIEFuZHJvaWQpXG4gICAqL1xuICBkZWZhdWx0OiBzdHJpbmcsXG4gIC8qKlxuICAgKiBEYXJrIGJhY2tncm91bmQsIHdoaXRlIHRleHRzIGFuZCBpY29uc1xuICAgKi9cbiAgJ2xpZ2h0LWNvbnRlbnQnOiBzdHJpbmcsXG4gIC8qKlxuICAgKiBMaWdodCBiYWNrZ3JvdW5kLCBkYXJrIHRleHRzIGFuZCBpY29uc1xuICAgKi9cbiAgJ2RhcmstY29udGVudCc6IHN0cmluZyxcbn0+O1xuXG4vKipcbiAqIFN0YXR1cyBiYXIgYW5pbWF0aW9uXG4gKi9cbmV4cG9ydCB0eXBlIFN0YXR1c0JhckFuaW1hdGlvbiA9ICRLZXlzPHtcbiAgLyoqXG4gICAqIE5vIGFuaW1hdGlvblxuICAgKi9cbiAgbm9uZTogc3RyaW5nLFxuICAvKipcbiAgICogRmFkZSBhbmltYXRpb25cbiAgICovXG4gIGZhZGU6IHN0cmluZyxcbiAgLyoqXG4gICAqIFNsaWRlIGFuaW1hdGlvblxuICAgKi9cbiAgc2xpZGU6IHN0cmluZyxcbn0+O1xuXG50eXBlIEFuZHJvaWRQcm9wcyA9ICRSZWFkT25seTx7fFxuICAvKipcbiAgICogVGhlIGJhY2tncm91bmQgY29sb3Igb2YgdGhlIHN0YXR1cyBiYXIuXG4gICAqIEBwbGF0Zm9ybSBhbmRyb2lkXG4gICAqL1xuICBiYWNrZ3JvdW5kQ29sb3I/OiA/c3RyaW5nLFxuICAvKipcbiAgICogSWYgdGhlIHN0YXR1cyBiYXIgaXMgdHJhbnNsdWNlbnQuXG4gICAqIFdoZW4gdHJhbnNsdWNlbnQgaXMgc2V0IHRvIHRydWUsIHRoZSBhcHAgd2lsbCBkcmF3IHVuZGVyIHRoZSBzdGF0dXMgYmFyLlxuICAgKiBUaGlzIGlzIHVzZWZ1bCB3aGVuIHVzaW5nIGEgc2VtaSB0cmFuc3BhcmVudCBzdGF0dXMgYmFyIGNvbG9yLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gYW5kcm9pZFxuICAgKi9cbiAgdHJhbnNsdWNlbnQ/OiA/Ym9vbGVhbixcbnx9PjtcblxudHlwZSBJT1NQcm9wcyA9ICRSZWFkT25seTx7fFxuICAvKipcbiAgICogSWYgdGhlIG5ldHdvcmsgYWN0aXZpdHkgaW5kaWNhdG9yIHNob3VsZCBiZSB2aXNpYmxlLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gaW9zXG4gICAqL1xuICBuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBUaGUgdHJhbnNpdGlvbiBlZmZlY3Qgd2hlbiBzaG93aW5nIGFuZCBoaWRpbmcgdGhlIHN0YXR1cyBiYXIgdXNpbmcgdGhlIGBoaWRkZW5gXG4gICAqIHByb3AuIERlZmF1bHRzIHRvICdmYWRlJy5cbiAgICpcbiAgICogQHBsYXRmb3JtIGlvc1xuICAgKi9cbiAgc2hvd0hpZGVUcmFuc2l0aW9uPzogPygnZmFkZScgfCAnc2xpZGUnKSxcbnx9PjtcblxudHlwZSBQcm9wcyA9ICRSZWFkT25seTx7fFxuICAuLi5BbmRyb2lkUHJvcHMsXG4gIC4uLklPU1Byb3BzLFxuICAvKipcbiAgICogSWYgdGhlIHN0YXR1cyBiYXIgaXMgaGlkZGVuLlxuICAgKi9cbiAgaGlkZGVuPzogP2Jvb2xlYW4sXG4gIC8qKlxuICAgKiBJZiB0aGUgdHJhbnNpdGlvbiBiZXR3ZWVuIHN0YXR1cyBiYXIgcHJvcGVydHkgY2hhbmdlcyBzaG91bGQgYmUgYW5pbWF0ZWQuXG4gICAqIFN1cHBvcnRlZCBmb3IgYmFja2dyb3VuZENvbG9yLCBiYXJTdHlsZSBhbmQgaGlkZGVuLlxuICAgKi9cbiAgYW5pbWF0ZWQ/OiA/Ym9vbGVhbixcbiAgLyoqXG4gICAqIFNldHMgdGhlIGNvbG9yIG9mIHRoZSBzdGF0dXMgYmFyIHRleHQuXG4gICAqL1xuICBiYXJTdHlsZT86ID8oJ2RlZmF1bHQnIHwgJ2xpZ2h0LWNvbnRlbnQnIHwgJ2RhcmstY29udGVudCcpLFxufH0+O1xuXG4vKipcbiAqIE1lcmdlcyB0aGUgcHJvcCBzdGFjayB3aXRoIHRoZSBkZWZhdWx0IHZhbHVlcy5cbiAqL1xuZnVuY3Rpb24gbWVyZ2VQcm9wc1N0YWNrKFxuICBwcm9wc1N0YWNrOiBBcnJheTxPYmplY3Q+LFxuICBkZWZhdWx0VmFsdWVzOiBPYmplY3QsXG4pOiBPYmplY3Qge1xuICByZXR1cm4gcHJvcHNTdGFjay5yZWR1Y2UoKHByZXYsIGN1cikgPT4ge1xuICAgIGZvciAoY29uc3QgcHJvcCBpbiBjdXIpIHtcbiAgICAgIGlmIChjdXJbcHJvcF0gIT0gbnVsbCkge1xuICAgICAgICBwcmV2W3Byb3BdID0gY3VyW3Byb3BdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcHJldjtcbiAgfSwgT2JqZWN0LmFzc2lnbih7fSwgZGVmYXVsdFZhbHVlcykpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYW4gb2JqZWN0IHRvIGluc2VydCBpbiB0aGUgcHJvcHMgc3RhY2sgZnJvbSB0aGUgcHJvcHNcbiAqIGFuZCB0aGUgdHJhbnNpdGlvbi9hbmltYXRpb24gaW5mby5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlU3RhY2tFbnRyeShwcm9wczogYW55KTogYW55IHtcbiAgcmV0dXJuIHtcbiAgICBiYWNrZ3JvdW5kQ29sb3I6XG4gICAgICBwcm9wcy5iYWNrZ3JvdW5kQ29sb3IgIT0gbnVsbFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy5iYWNrZ3JvdW5kQ29sb3IsXG4gICAgICAgICAgICBhbmltYXRlZDogcHJvcHMuYW5pbWF0ZWQsXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGwsXG4gICAgYmFyU3R5bGU6XG4gICAgICBwcm9wcy5iYXJTdHlsZSAhPSBudWxsXG4gICAgICAgID8ge1xuICAgICAgICAgICAgdmFsdWU6IHByb3BzLmJhclN0eWxlLFxuICAgICAgICAgICAgYW5pbWF0ZWQ6IHByb3BzLmFuaW1hdGVkLFxuICAgICAgICAgIH1cbiAgICAgICAgOiBudWxsLFxuICAgIHRyYW5zbHVjZW50OiBwcm9wcy50cmFuc2x1Y2VudCxcbiAgICBoaWRkZW46XG4gICAgICBwcm9wcy5oaWRkZW4gIT0gbnVsbFxuICAgICAgICA/IHtcbiAgICAgICAgICAgIHZhbHVlOiBwcm9wcy5oaWRkZW4sXG4gICAgICAgICAgICBhbmltYXRlZDogcHJvcHMuYW5pbWF0ZWQsXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBwcm9wcy5zaG93SGlkZVRyYW5zaXRpb24sXG4gICAgICAgICAgfVxuICAgICAgICA6IG51bGwsXG4gICAgbmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZTogcHJvcHMubmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSxcbiAgfTtcbn1cblxuLyoqXG4gKiBDb21wb25lbnQgdG8gY29udHJvbCB0aGUgYXBwIHN0YXR1cyBiYXIuXG4gKlxuICogIyMjIFVzYWdlIHdpdGggTmF2aWdhdG9yXG4gKlxuICogSXQgaXMgcG9zc2libGUgdG8gaGF2ZSBtdWx0aXBsZSBgU3RhdHVzQmFyYCBjb21wb25lbnRzIG1vdW50ZWQgYXQgdGhlIHNhbWVcbiAqIHRpbWUuIFRoZSBwcm9wcyB3aWxsIGJlIG1lcmdlZCBpbiB0aGUgb3JkZXIgdGhlIGBTdGF0dXNCYXJgIGNvbXBvbmVudHMgd2VyZVxuICogbW91bnRlZC4gT25lIHVzZSBjYXNlIGlzIHRvIHNwZWNpZnkgc3RhdHVzIGJhciBzdHlsZXMgcGVyIHJvdXRlIHVzaW5nIGBOYXZpZ2F0b3JgLlxuICpcbiAqIGBgYFxuICogIDxWaWV3PlxuICogICAgPFN0YXR1c0JhclxuICogICAgICBiYWNrZ3JvdW5kQ29sb3I9XCJibHVlXCJcbiAqICAgICAgYmFyU3R5bGU9XCJsaWdodC1jb250ZW50XCJcbiAqICAgIC8+XG4gKiAgICA8TmF2aWdhdG9yXG4gKiAgICAgIGluaXRpYWxSb3V0ZT17e3N0YXR1c0JhckhpZGRlbjogdHJ1ZX19XG4gKiAgICAgIHJlbmRlclNjZW5lPXsocm91dGUsIG5hdmlnYXRvcikgPT5cbiAqICAgICAgICA8Vmlldz5cbiAqICAgICAgICAgIDxTdGF0dXNCYXIgaGlkZGVuPXtyb3V0ZS5zdGF0dXNCYXJIaWRkZW59IC8+XG4gKiAgICAgICAgICAuLi5cbiAqICAgICAgICA8L1ZpZXc+XG4gKiAgICAgIH1cbiAqICAgIC8+XG4gKiAgPC9WaWV3PlxuICogYGBgXG4gKlxuICogIyMjIEltcGVyYXRpdmUgQVBJXG4gKlxuICogRm9yIGNhc2VzIHdoZXJlIHVzaW5nIGEgY29tcG9uZW50IGlzIG5vdCBpZGVhbCwgdGhlcmUgYXJlIHN0YXRpYyBtZXRob2RzXG4gKiB0byBtYW5pcHVsYXRlIHRoZSBgU3RhdHVzQmFyYCBkaXNwbGF5IHN0YWNrLiBUaGVzZSBtZXRob2RzIGhhdmUgdGhlIHNhbWVcbiAqIGJlaGF2aW9yIGFzIG1vdW50aW5nIGFuZCB1bm1vdW50aW5nIGEgYFN0YXR1c0JhcmAgY29tcG9uZW50LlxuICpcbiAqIEZvciBleGFtcGxlLCB5b3UgY2FuIGNhbGwgYFN0YXR1c0Jhci5wdXNoU3RhY2tFbnRyeWAgdG8gdXBkYXRlIHRoZSBzdGF0dXMgYmFyXG4gKiBiZWZvcmUgbGF1bmNoaW5nIGEgdGhpcmQtcGFydHkgbmF0aXZlIFVJIGNvbXBvbmVudCwgYW5kIHRoZW4gY2FsbFxuICogYFN0YXR1c0Jhci5wb3BTdGFja0VudHJ5YCB3aGVuIGNvbXBsZXRlZC5cbiAqXG4gKiBgYGBcbiAqIGNvbnN0IG9wZW5UaGlyZFBhcnR5QnVnUmVwb3J0ZXIgPSBhc3luYyAoKSA9PiB7XG4gKiAgIC8vIFRoZSBidWcgcmVwb3J0ZXIgaGFzIGEgZGFyayBiYWNrZ3JvdW5kLCBzbyB3ZSBwdXNoIGEgbmV3IHN0YXR1cyBiYXIgc3R5bGUuXG4gKiAgIGNvbnN0IHN0YWNrRW50cnkgPSBTdGF0dXNCYXIucHVzaFN0YWNrRW50cnkoe2JhclN0eWxlOiAnbGlnaHQtY29udGVudCd9KTtcbiAqXG4gKiAgIC8vIGBvcGVuYCByZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gdGhlIFVJIGlzIGRpc21pc3NlZC5cbiAqICAgYXdhaXQgQnVnUmVwb3J0ZXIub3BlbigpO1xuICpcbiAqICAgLy8gRG9uJ3QgZm9yZ2V0IHRvIGNhbGwgYHBvcFN0YWNrRW50cnlgIHdoZW4geW91J3JlIGRvbmUuXG4gKiAgIFN0YXR1c0Jhci5wb3BTdGFja0VudHJ5KHN0YWNrRW50cnkpO1xuICogfTtcbiAqIGBgYFxuICpcbiAqIFRoZXJlIGlzIGEgbGVnYWN5IGltcGVyYXRpdmUgQVBJIHRoYXQgZW5hYmxlcyB5b3UgdG8gbWFudWFsbHkgdXBkYXRlIHRoZVxuICogc3RhdHVzIGJhciBzdHlsZXMuIEhvd2V2ZXIsIHRoZSBsZWdhY3kgQVBJIGRvZXMgbm90IHVwZGF0ZSB0aGUgaW50ZXJuYWxcbiAqIGBTdGF0dXNCYXJgIGRpc3BsYXkgc3RhY2ssIHdoaWNoIG1lYW5zIHRoYXQgYW55IGNoYW5nZXMgd2lsbCBiZSBvdmVycmlkZGVuXG4gKiB3aGVuZXZlciBhIGBTdGF0dXNCYXJgIGNvbXBvbmVudCBpcyBtb3VudGVkIG9yIHVubW91bnRlZC5cbiAqXG4gKiBJdCBpcyBzdHJvbmdseSBhZHZpc2VkIHRoYXQgeW91IHVzZSBgcHVzaFN0YWNrRW50cnlgLCBgcG9wU3RhY2tFbnRyeWAsIG9yXG4gKiBgcmVwbGFjZVN0YWNrRW50cnlgIGluc3RlYWQgb2YgdGhlIHN0YXRpYyBtZXRob2RzIGJlZ2lubmluZyB3aXRoIGBzZXRgLlxuICpcbiAqICMjIyBDb25zdGFudHNcbiAqXG4gKiBgY3VycmVudEhlaWdodGAgKEFuZHJvaWQgb25seSkgVGhlIGhlaWdodCBvZiB0aGUgc3RhdHVzIGJhci5cbiAqL1xuY2xhc3MgU3RhdHVzQmFyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50PFByb3BzPiB7XG4gIHN0YXRpYyBfcHJvcHNTdGFjayA9IFtdO1xuXG4gIHN0YXRpYyBfZGVmYXVsdFByb3BzID0gY3JlYXRlU3RhY2tFbnRyeSh7XG4gICAgYW5pbWF0ZWQ6IGZhbHNlLFxuICAgIHNob3dIaWRlVHJhbnNpdGlvbjogJ2ZhZGUnLFxuICAgIGJhY2tncm91bmRDb2xvcjogUGxhdGZvcm0uc2VsZWN0KHtcbiAgICAgIGFuZHJvaWQ6IFN0YXR1c0Jhck1hbmFnZXIuREVGQVVMVF9CQUNLR1JPVU5EX0NPTE9SID8/ICdibGFjaycsXG4gICAgICBpb3M6ICdibGFjaycsXG4gICAgfSksXG4gICAgYmFyU3R5bGU6ICdkZWZhdWx0JyxcbiAgICB0cmFuc2x1Y2VudDogZmFsc2UsXG4gICAgaGlkZGVuOiBmYWxzZSxcbiAgICBuZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlOiBmYWxzZSxcbiAgfSk7XG5cbiAgLy8gVGltZXIgZm9yIHVwZGF0aW5nIHRoZSBuYXRpdmUgbW9kdWxlIHZhbHVlcyBhdCB0aGUgZW5kIG9mIHRoZSBmcmFtZS5cbiAgc3RhdGljIF91cGRhdGVJbW1lZGlhdGUgPSBudWxsO1xuXG4gIC8vIFRoZSBjdXJyZW50IG1lcmdlZCB2YWx1ZXMgZnJvbSB0aGUgcHJvcHMgc3RhY2suXG4gIHN0YXRpYyBfY3VycmVudFZhbHVlcyA9IG51bGw7XG5cbiAgLy8gVE9ETyhqYW5pYyk6IFByb3ZpZGUgYSByZWFsIEFQSSB0byBkZWFsIHdpdGggc3RhdHVzIGJhciBoZWlnaHQuIFNlZSB0aGVcbiAgLy8gZGlzY3Vzc2lvbiBpbiAjNjE5NS5cbiAgLyoqXG4gICAqIFRoZSBjdXJyZW50IGhlaWdodCBvZiB0aGUgc3RhdHVzIGJhciBvbiB0aGUgZGV2aWNlLlxuICAgKlxuICAgKiBAcGxhdGZvcm0gYW5kcm9pZFxuICAgKi9cbiAgc3RhdGljIGN1cnJlbnRIZWlnaHQgPSBTdGF0dXNCYXJNYW5hZ2VyLkhFSUdIVDtcblxuICAvLyBQcm92aWRlIGFuIGltcGVyYXRpdmUgQVBJIGFzIHN0YXRpYyBmdW5jdGlvbnMgb2YgdGhlIGNvbXBvbmVudC5cbiAgLy8gU2VlIHRoZSBjb3JyZXNwb25kaW5nIHByb3AgZm9yIG1vcmUgZGV0YWlsLlxuXG4gIC8qKlxuICAgKiBTaG93IG9yIGhpZGUgdGhlIHN0YXR1cyBiYXJcbiAgICogQHBhcmFtIGhpZGRlbiBIaWRlIHRoZSBzdGF0dXMgYmFyLlxuICAgKiBAcGFyYW0gYW5pbWF0aW9uIE9wdGlvbmFsIGFuaW1hdGlvbiB3aGVuXG4gICAqICAgIGNoYW5naW5nIHRoZSBzdGF0dXMgYmFyIGhpZGRlbiBwcm9wZXJ0eS5cbiAgICovXG4gIHN0YXRpYyBzZXRIaWRkZW4oaGlkZGVuOiBib29sZWFuLCBhbmltYXRpb24/OiBTdGF0dXNCYXJBbmltYXRpb24pIHtcbiAgICBhbmltYXRpb24gPSBhbmltYXRpb24gfHwgJ25vbmUnO1xuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLmhpZGRlbi52YWx1ZSA9IGhpZGRlbjtcbiAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICBTdGF0dXNCYXJNYW5hZ2VyLnNldEhpZGRlbihoaWRkZW4sIGFuaW1hdGlvbik7XG4gICAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICBTdGF0dXNCYXJNYW5hZ2VyLnNldEhpZGRlbihoaWRkZW4pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIHN0YXR1cyBiYXIgc3R5bGVcbiAgICogQHBhcmFtIHN0eWxlIFN0YXR1cyBiYXIgc3R5bGUgdG8gc2V0XG4gICAqIEBwYXJhbSBhbmltYXRlZCBBbmltYXRlIHRoZSBzdHlsZSBjaGFuZ2UuXG4gICAqL1xuICBzdGF0aWMgc2V0QmFyU3R5bGUoc3R5bGU6IFN0YXR1c0JhclN0eWxlLCBhbmltYXRlZD86IGJvb2xlYW4pIHtcbiAgICBhbmltYXRlZCA9IGFuaW1hdGVkIHx8IGZhbHNlO1xuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLmJhclN0eWxlLnZhbHVlID0gc3R5bGU7XG4gICAgaWYgKFBsYXRmb3JtLk9TID09PSAnaW9zJykge1xuICAgICAgU3RhdHVzQmFyTWFuYWdlci5zZXRTdHlsZShzdHlsZSwgYW5pbWF0ZWQpO1xuICAgIH0gZWxzZSBpZiAoUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJykge1xuICAgICAgU3RhdHVzQmFyTWFuYWdlci5zZXRTdHlsZShzdHlsZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbnRyb2wgdGhlIHZpc2liaWxpdHkgb2YgdGhlIG5ldHdvcmsgYWN0aXZpdHkgaW5kaWNhdG9yXG4gICAqIEBwYXJhbSB2aXNpYmxlIFNob3cgdGhlIGluZGljYXRvci5cbiAgICovXG4gIHN0YXRpYyBzZXROZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlKHZpc2libGU6IGJvb2xlYW4pIHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdpb3MnKSB7XG4gICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICdgc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZWAgaXMgb25seSBhdmFpbGFibGUgb24gaU9TJyxcbiAgICAgICk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIFN0YXR1c0Jhci5fZGVmYXVsdFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUgPSB2aXNpYmxlO1xuICAgIFN0YXR1c0Jhck1hbmFnZXIuc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZSh2aXNpYmxlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgdGhlIGJhY2tncm91bmQgY29sb3IgZm9yIHRoZSBzdGF0dXMgYmFyXG4gICAqIEBwYXJhbSBjb2xvciBCYWNrZ3JvdW5kIGNvbG9yLlxuICAgKiBAcGFyYW0gYW5pbWF0ZWQgQW5pbWF0ZSB0aGUgc3R5bGUgY2hhbmdlLlxuICAgKi9cbiAgc3RhdGljIHNldEJhY2tncm91bmRDb2xvcihjb2xvcjogc3RyaW5nLCBhbmltYXRlZD86IGJvb2xlYW4pIHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJykge1xuICAgICAgY29uc29sZS53YXJuKCdgc2V0QmFja2dyb3VuZENvbG9yYCBpcyBvbmx5IGF2YWlsYWJsZSBvbiBBbmRyb2lkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGFuaW1hdGVkID0gYW5pbWF0ZWQgfHwgZmFsc2U7XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlID0gY29sb3I7XG4gICAgU3RhdHVzQmFyTWFuYWdlci5zZXRDb2xvcihwcm9jZXNzQ29sb3IoY29sb3IpLCBhbmltYXRlZCk7XG4gIH1cblxuICAvKipcbiAgICogQ29udHJvbCB0aGUgdHJhbnNsdWNlbmN5IG9mIHRoZSBzdGF0dXMgYmFyXG4gICAqIEBwYXJhbSB0cmFuc2x1Y2VudCBTZXQgYXMgdHJhbnNsdWNlbnQuXG4gICAqL1xuICBzdGF0aWMgc2V0VHJhbnNsdWNlbnQodHJhbnNsdWNlbnQ6IGJvb2xlYW4pIHtcbiAgICBpZiAoUGxhdGZvcm0uT1MgIT09ICdhbmRyb2lkJykge1xuICAgICAgY29uc29sZS53YXJuKCdgc2V0VHJhbnNsdWNlbnRgIGlzIG9ubHkgYXZhaWxhYmxlIG9uIEFuZHJvaWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgU3RhdHVzQmFyLl9kZWZhdWx0UHJvcHMudHJhbnNsdWNlbnQgPSB0cmFuc2x1Y2VudDtcbiAgICBTdGF0dXNCYXJNYW5hZ2VyLnNldFRyYW5zbHVjZW50KHRyYW5zbHVjZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQdXNoIGEgU3RhdHVzQmFyIGVudHJ5IG9udG8gdGhlIHN0YWNrLlxuICAgKiBUaGUgcmV0dXJuIHZhbHVlIHNob3VsZCBiZSBwYXNzZWQgdG8gYHBvcFN0YWNrRW50cnlgIHdoZW4gY29tcGxldGUuXG4gICAqXG4gICAqIEBwYXJhbSBwcm9wcyBPYmplY3QgY29udGFpbmluZyB0aGUgU3RhdHVzQmFyIHByb3BzIHRvIHVzZSBpbiB0aGUgc3RhY2sgZW50cnkuXG4gICAqL1xuICBzdGF0aWMgcHVzaFN0YWNrRW50cnkocHJvcHM6IGFueSkge1xuICAgIGNvbnN0IGVudHJ5ID0gY3JlYXRlU3RhY2tFbnRyeShwcm9wcyk7XG4gICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrLnB1c2goZW50cnkpO1xuICAgIFN0YXR1c0Jhci5fdXBkYXRlUHJvcHNTdGFjaygpO1xuICAgIHJldHVybiBlbnRyeTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQb3AgYSBTdGF0dXNCYXIgZW50cnkgZnJvbSB0aGUgc3RhY2suXG4gICAqXG4gICAqIEBwYXJhbSBlbnRyeSBFbnRyeSByZXR1cm5lZCBmcm9tIGBwdXNoU3RhY2tFbnRyeWAuXG4gICAqL1xuICBzdGF0aWMgcG9wU3RhY2tFbnRyeShlbnRyeTogYW55KSB7XG4gICAgY29uc3QgaW5kZXggPSBTdGF0dXNCYXIuX3Byb3BzU3RhY2suaW5kZXhPZihlbnRyeSk7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrLnNwbGljZShpbmRleCwgMSk7XG4gICAgfVxuICAgIFN0YXR1c0Jhci5fdXBkYXRlUHJvcHNTdGFjaygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlcGxhY2UgYW4gZXhpc3RpbmcgU3RhdHVzQmFyIHN0YWNrIGVudHJ5IHdpdGggbmV3IHByb3BzLlxuICAgKlxuICAgKiBAcGFyYW0gZW50cnkgRW50cnkgcmV0dXJuZWQgZnJvbSBgcHVzaFN0YWNrRW50cnlgIHRvIHJlcGxhY2UuXG4gICAqIEBwYXJhbSBwcm9wcyBPYmplY3QgY29udGFpbmluZyB0aGUgU3RhdHVzQmFyIHByb3BzIHRvIHVzZSBpbiB0aGUgcmVwbGFjZW1lbnQgc3RhY2sgZW50cnkuXG4gICAqL1xuICBzdGF0aWMgcmVwbGFjZVN0YWNrRW50cnkoZW50cnk6IGFueSwgcHJvcHM6IGFueSkge1xuICAgIGNvbnN0IG5ld0VudHJ5ID0gY3JlYXRlU3RhY2tFbnRyeShwcm9wcyk7XG4gICAgY29uc3QgaW5kZXggPSBTdGF0dXNCYXIuX3Byb3BzU3RhY2suaW5kZXhPZihlbnRyeSk7XG4gICAgaWYgKGluZGV4ICE9PSAtMSkge1xuICAgICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrW2luZGV4XSA9IG5ld0VudHJ5O1xuICAgIH1cbiAgICBTdGF0dXNCYXIuX3VwZGF0ZVByb3BzU3RhY2soKTtcbiAgICByZXR1cm4gbmV3RW50cnk7XG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGFuaW1hdGVkOiBmYWxzZSxcbiAgICBzaG93SGlkZVRyYW5zaXRpb246ICdmYWRlJyxcbiAgfTtcblxuICBfc3RhY2tFbnRyeSA9IG51bGw7XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgLy8gRXZlcnkgdGltZSBhIFN0YXR1c0JhciBjb21wb25lbnQgaXMgbW91bnRlZCwgd2UgcHVzaCBpdCdzIHByb3AgdG8gYSBzdGFja1xuICAgIC8vIGFuZCBhbHdheXMgdXBkYXRlIHRoZSBuYXRpdmUgc3RhdHVzIGJhciB3aXRoIHRoZSBwcm9wcyBmcm9tIHRoZSB0b3Agb2YgdGhlblxuICAgIC8vIHN0YWNrLiBUaGlzIGFsbG93cyBoYXZpbmcgbXVsdGlwbGUgU3RhdHVzQmFyIGNvbXBvbmVudHMgYW5kIHRoZSBvbmUgdGhhdCBpc1xuICAgIC8vIGFkZGVkIGxhc3Qgb3IgaXMgZGVlcGVyIGluIHRoZSB2aWV3IGhpZXJhY2h5IHdpbGwgaGF2ZSBwcmlvcml0eS5cbiAgICB0aGlzLl9zdGFja0VudHJ5ID0gU3RhdHVzQmFyLnB1c2hTdGFja0VudHJ5KHRoaXMucHJvcHMpO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbFVubW91bnQoKSB7XG4gICAgLy8gV2hlbiBhIFN0YXR1c0JhciBpcyB1bm1vdW50ZWQsIHJlbW92ZSBpdHNlbGYgZnJvbSB0aGUgc3RhY2sgYW5kIHVwZGF0ZVxuICAgIC8vIHRoZSBuYXRpdmUgYmFyIHdpdGggdGhlIG5leHQgcHJvcHMuXG4gICAgU3RhdHVzQmFyLnBvcFN0YWNrRW50cnkodGhpcy5fc3RhY2tFbnRyeSk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgdGhpcy5fc3RhY2tFbnRyeSA9IFN0YXR1c0Jhci5yZXBsYWNlU3RhY2tFbnRyeShcbiAgICAgIHRoaXMuX3N0YWNrRW50cnksXG4gICAgICB0aGlzLnByb3BzLFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlcyB0aGUgbmF0aXZlIHN0YXR1cyBiYXIgd2l0aCB0aGUgcHJvcHMgZnJvbSB0aGUgc3RhY2suXG4gICAqL1xuICBzdGF0aWMgX3VwZGF0ZVByb3BzU3RhY2sgPSAoKSA9PiB7XG4gICAgLy8gU2VuZCB0aGUgdXBkYXRlIHRvIHRoZSBuYXRpdmUgbW9kdWxlIG9ubHkgb25jZSBhdCB0aGUgZW5kIG9mIHRoZSBmcmFtZS5cbiAgICBjbGVhckltbWVkaWF0ZShTdGF0dXNCYXIuX3VwZGF0ZUltbWVkaWF0ZSk7XG4gICAgU3RhdHVzQmFyLl91cGRhdGVJbW1lZGlhdGUgPSBzZXRJbW1lZGlhdGUoKCkgPT4ge1xuICAgICAgY29uc3Qgb2xkUHJvcHMgPSBTdGF0dXNCYXIuX2N1cnJlbnRWYWx1ZXM7XG4gICAgICBjb25zdCBtZXJnZWRQcm9wcyA9IG1lcmdlUHJvcHNTdGFjayhcbiAgICAgICAgU3RhdHVzQmFyLl9wcm9wc1N0YWNrLFxuICAgICAgICBTdGF0dXNCYXIuX2RlZmF1bHRQcm9wcyxcbiAgICAgICk7XG5cbiAgICAgIC8vIFVwZGF0ZSB0aGUgcHJvcHMgdGhhdCBoYXZlIGNoYW5nZWQgdXNpbmcgdGhlIG1lcmdlZCB2YWx1ZXMgZnJvbSB0aGUgcHJvcHMgc3RhY2suXG4gICAgICBpZiAoUGxhdGZvcm0uT1MgPT09ICdpb3MnKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhb2xkUHJvcHMgfHxcbiAgICAgICAgICBvbGRQcm9wcy5iYXJTdHlsZS52YWx1ZSAhPT0gbWVyZ2VkUHJvcHMuYmFyU3R5bGUudmFsdWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgU3RhdHVzQmFyTWFuYWdlci5zZXRTdHlsZShcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmJhclN0eWxlLnZhbHVlLFxuICAgICAgICAgICAgbWVyZ2VkUHJvcHMuYmFyU3R5bGUuYW5pbWF0ZWQgfHwgZmFsc2UsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9sZFByb3BzIHx8IG9sZFByb3BzLmhpZGRlbi52YWx1ZSAhPT0gbWVyZ2VkUHJvcHMuaGlkZGVuLnZhbHVlKSB7XG4gICAgICAgICAgU3RhdHVzQmFyTWFuYWdlci5zZXRIaWRkZW4oXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUsXG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5oaWRkZW4uYW5pbWF0ZWRcbiAgICAgICAgICAgICAgPyBtZXJnZWRQcm9wcy5oaWRkZW4udHJhbnNpdGlvblxuICAgICAgICAgICAgICA6ICdub25lJyxcbiAgICAgICAgICApO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKFxuICAgICAgICAgICFvbGRQcm9wcyB8fFxuICAgICAgICAgIG9sZFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUgIT09XG4gICAgICAgICAgICBtZXJnZWRQcm9wcy5uZXR3b3JrQWN0aXZpdHlJbmRpY2F0b3JWaXNpYmxlXG4gICAgICAgICkge1xuICAgICAgICAgIFN0YXR1c0Jhck1hbmFnZXIuc2V0TmV0d29ya0FjdGl2aXR5SW5kaWNhdG9yVmlzaWJsZShcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLm5ldHdvcmtBY3Rpdml0eUluZGljYXRvclZpc2libGUsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhb2xkUHJvcHMgfHxcbiAgICAgICAgICBvbGRQcm9wcy5iYXJTdHlsZS52YWx1ZSAhPT0gbWVyZ2VkUHJvcHMuYmFyU3R5bGUudmFsdWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgU3RhdHVzQmFyTWFuYWdlci5zZXRTdHlsZShtZXJnZWRQcm9wcy5iYXJTdHlsZS52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFxuICAgICAgICAgICFvbGRQcm9wcyB8fFxuICAgICAgICAgIG9sZFByb3BzLmJhY2tncm91bmRDb2xvci52YWx1ZSAhPT0gbWVyZ2VkUHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlXG4gICAgICAgICkge1xuICAgICAgICAgIFN0YXR1c0Jhck1hbmFnZXIuc2V0Q29sb3IoXG4gICAgICAgICAgICBwcm9jZXNzQ29sb3IobWVyZ2VkUHJvcHMuYmFja2dyb3VuZENvbG9yLnZhbHVlKSxcbiAgICAgICAgICAgIG1lcmdlZFByb3BzLmJhY2tncm91bmRDb2xvci5hbmltYXRlZCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb2xkUHJvcHMgfHwgb2xkUHJvcHMuaGlkZGVuLnZhbHVlICE9PSBtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUpIHtcbiAgICAgICAgICBTdGF0dXNCYXJNYW5hZ2VyLnNldEhpZGRlbihtZXJnZWRQcm9wcy5oaWRkZW4udmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb2xkUHJvcHMgfHwgb2xkUHJvcHMudHJhbnNsdWNlbnQgIT09IG1lcmdlZFByb3BzLnRyYW5zbHVjZW50KSB7XG4gICAgICAgICAgU3RhdHVzQmFyTWFuYWdlci5zZXRUcmFuc2x1Y2VudChtZXJnZWRQcm9wcy50cmFuc2x1Y2VudCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIC8vIFVwZGF0ZSB0aGUgY3VycmVudCBwcm9wIHZhbHVlcy5cbiAgICAgIFN0YXR1c0Jhci5fY3VycmVudFZhbHVlcyA9IG1lcmdlZFByb3BzO1xuICAgIH0pO1xuICB9O1xuXG4gIHJlbmRlcigpOiBSZWFjdC5Ob2RlIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IFN0YXR1c0JhcjtcbiJdfQ==